<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>–ê–¥–º–∏–Ω - –†–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div id="admin-panel" style="display: none;">
        <div class="container mt-5">
            <h1 class="text-center text-danger fw-bold mb-4">üìã –í—Å–∏—á–∫–∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</h1>
            <div class="d-flex justify-content-end mb-3">
                <button id="filter-today" class="btn btn-outline-primary">üìÖ –ü–æ–∫–∞–∂–∏ —Å–∞–º–æ –¥–Ω–µ—à–Ω–∏—Ç–µ</button>
                <button id="show-all" class="btn btn-outline-secondary ms-2">üîÑ –ü–æ–∫–∞–∑–≤–∞–π –≤—Å–∏—á–∫–∏</button>
            </div>
      
            <div class="table-responsive">
              <table class="table table-bordered table-striped">
                <thead class="table-dark">
                  <tr>
                    <th>#</th>
                    <th>–ò–º–µ</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th>–ì–æ—Å—Ç–∏</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ß–∞—Å</th>
                    <th>–°—ä–æ–±—â–µ–Ω–∏–µ</th>
                    <th>–°—ä–∑–¥–∞–¥–µ–Ω–∞</th>
                  </tr>
                </thead>
                <tbody id="reservations-body">
                  <tr><td colspan="8" class="text-center">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</td></tr>
                </tbody>
              </table>
            </div>
        </div>
    </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>


    const client = window.supabase.createClient(
        'https://huullvfombogfhmssqrc.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1dWxsdmZvbWJvZ2ZobXNzcXJjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4NDIyNzAsImV4cCI6MjA2MDQxODI3MH0.7UGhnlUl3FkTQBW9YNTAvbrv5v3GWuRawGlZJAEg5UY'
    );

    const entered = prompt("üîê –ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –ø–∞—Ä–æ–ª–∞ –∑–∞ –¥–æ—Å—Ç—ä–ø:");
    const panel = document.getElementById("admin-panel");


    if (entered !== "Dimitar.69") {
      alert("‚õîÔ∏è –ì—Ä–µ—à–Ω–∞ –ø–∞—Ä–æ–ª–∞!");
      window.location.href = "index.html";
    } else {
      panel.style.display = "block"; // –ø–æ–∫–∞–∑–≤–∞ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∞
      loadReservations();            // —á–∞–∫ —Ç–æ–≥–∞–≤–∞ –∑–∞—Ä–µ–∂–¥–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏—Ç–µ
    }
   
    async function loadReservations() {
      const { data, error } = await client
        .from('reservation')
        .select('*')
        .order('created_at', { ascending: false });
      console.log("üîç Supabase –¥–∞–Ω–Ω–∏:", data);
  
    
      const tbody = document.getElementById('reservations-body');
      tbody.innerHTML = '';
    
      if (error) {
        tbody.innerHTML = `<tr><td colspan="8" class="text-danger text-center">–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ!</td></tr>`;
        console.error(error);
        return;
      }
    
      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" class="text-center">–ù—è–º–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏.</td></tr>`;
        return;
      }


      data.forEach((res, index) => {
        const localDate = new Date(res.created_at);
        localDate.setHours(localDate.getHours() + 3);
        tbody.innerHTML += `
          <tr>
            <td>${index + 1}</td>
            <td>${res.name}</td>
            <td>${res.phone}</td>
            <td>${res.guests}</td>
            <td>${res.date}</td>
            <td>${res.time}</td>
            <td>${res.message || ''}</td>
            <td>${localDate.toLocaleString("bg-BG")}</td>

          </tr>
        `;
      });
    }
    document.getElementById("filter-today").addEventListener("click", async () => {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      const formatted = `${yyyy}-${mm}-${dd}`;

      const { data, error } = await client
        .from("reservation")
        .select("*")
        .order("created_at", { ascending: false });


      renderReservations(data, error);
    });

    document.getElementById("show-all").addEventListener("click", loadReservations);

    // –ò–∑–Ω–µ—Å–∏ —Ç–æ–≤–∞ –∫–∞—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞ —É–ø–æ—Ç—Ä–µ–±–∞
    function renderReservations(data, error) {
      const tbody = document.getElementById("reservations-body");
      tbody.innerHTML = '';

      if (error) {
        tbody.innerHTML = `<tr><td colspan="8" class="text-danger text-center">–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ!</td></tr>`;
        console.error(error);
        return;
      }

      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" class="text-center">–ù—è–º–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏.</td></tr>`;
        return;
      }

      data.forEach((res, index) => {
        tbody.innerHTML += `
          <tr>
            <td>${index + 1}</td>
            <td>${res.name}</td>
            <td>${res.phone}</td>
            <td>${res.guests}</td>
            <td>${res.date}</td>
            <td>${res.time}</td>
            <td>${res.message || ''}</td>
            <td>${localDate.toLocaleString("bg-BG")}</td>

          </tr>
        `;
      });
    }

    

  </script>

</body>
</html>
